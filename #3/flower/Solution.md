## 落英

### 题目大意

给定一棵树，其上节点有$2$种颜色。有修改颜色、修改点权两种修改操作。每次询问某个点的同色联通块中的点数、点权最大值、与这个点相连的点权第$k$大

### Solution

暴力相信大家都会。只要每次询问$dfs$整棵树。

考虑怎样优化。建一颗黑树和一棵白树。每棵树中包含黑/白颜色的所有点。就相当于维护整个联通块的信息。

怎样维护？如果直接用$LCT$，那么改颜色时要切断/连上所有和这个点相连的边，时间复杂度是O(度数)。当每个点的度数都是常数时（3、4两个Subtask）的确很优秀。但是当某个点度数很大时，可能就要GG了。

可不可以修改颜色时只切断/连上常数条边？可以用边来表示某个点的颜色。即：建一棵黑树，一棵白树，它们都包含所有点。一条边$(u,fa_u)$(强行有根)在某棵树上存在相当于表示了点$u$是什么颜色。这样，修改某个点时，只要改它和它父亲的边就可以。

怎么用$LCT$维护？可以每个点记录它所有虚儿子的信息，实儿子用$LCT$维护（当然，可以用全局平衡二叉树）。

点的个数直接就能维护了。由于$Max$不具可减性，所以只能对每个点用$set$记录所有轻儿子信息。

时间复杂度$O(n \log ^2 n)$

欢迎各位数据结构大神来吊打标算。

#### Tips

Q: 好像$3$操作是在搞笑？不是对每个点维护它所有儿子的权值线段树/平衡树就行了。和其他两个操作毫无关系呀。

A: 对啊。可是它很有趣，~~强行增加了代码长度~~
